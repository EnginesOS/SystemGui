<% active_menu_item = case
    when params[:controller] == 'desktops'
      :desktop
    when params[:controller] == 'systems', params[:controller] == 'system_securities', params[:controller] == 'system_securities'
      :system
    else
      :control_panel
    end
%>

<% if user_signed_in? %>
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
	  <div class="container-fluid">
	    <div class="navbar-header">
	      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse">
	        <span class="sr-only">Toggle navigation</span>
	        <i class="fa fa-caret-down"></i>
	      </button>
	      <%= link_to image_tag("engines_logo.png", class: "navbar-icon"), root_path, class: 'trigger-response-modal navbar-brand' %>
		  <div id="status_message_area_when_menu_collpased">
    	  </div>

	    </div>
	
	    <!-- Collect the nav links, forms, and other content for toggling -->
	    <div class="collapse navbar-collapse" id="main-navbar-collapse">
	      <ul class="nav navbar-nav">
	        <li class="<%= 'active' if active_menu_item == :desktop %>">
	          <%= link_to content_tag(:i, "", class: "fa fa-desktop") + " Desktop", desktop_path, title: 'Desktop', class: 'trigger-response-modal' %>
	        </li>
	        <li class="<%= 'active' if active_menu_item == :control_panel %>">
	          <%= link_to content_tag(:i, "", class: "fa fa-cogs") + " Control panel", control_panel_path, class: 'trigger-response-modal' %>
	        </li>
	        <li class="dropdown <%= 'active' if active_menu_item == :system %>">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown"><%= content_tag(:i, "", class: "fa fa-hdd-o") %> System <span class="caret"></span></a>
          <ul class="dropdown-menu">
		    <li>
		    	<%= link_to content_tag(:i, "", class: "fa fa-repeat") + ' Update', updater_system_path,
					class: 'btn-lg trigger-response-modal' %>
			</li>
			<li class="divider"></li>
		    <li>
				<%= link_to content_tag(:i, "", class: "fa fa-pie-chart") + ' Monitor', monitor_system_path, class: "btn-lg trigger-response-modal" %>
		    </li>
			<li class="divider"></li>
		    <li>
				<%= link_to content_tag(:i, "", class: "fa fa-user-secret") + ' Security', system_security_path, class: "btn-lg trigger-response-modal" %>
		    </li>
			<li class="divider"></li>
		    <li>
		    	<%= link_to content_tag(:i, "", class: "fa fa-power-off") + ' Reboot', restart_system_path,
					class: 'btn-lg trigger-response-modal' %>
			</li>
          </ul>
        </li>
	        



	        
	        
	        
			<li id="status_message_area_when_menu_not_collpased">
				<% if @system_status[:button_url].present? %>
	    	  		<a href="<%= @system_status[:button_url] %>" id="system_status_navbar_message_button" class="<%= @system_status[:message_class] %>">
				  		<span id="system_status_navbar_message" class="<%= @system_status[:message_class] %>"><i class="fa fa-heartbeat"></i> <%= @system_status[:message] %></span>
    	  	  		</a>
    	  	  	<% else %>
	    	  		<div id="system_status_navbar_message_button" class="<%= @system_status[:message_class] %>">
				  		<span id="system_status_navbar_message" class="<%= @system_status[:message_class] %>"><i class="fa fa-heartbeat"></i> <%= @system_status[:message] %></span>
    	  	  		</div>
    	  	  	<% end %>
			</li>
	      </ul>
	      <ul class="nav navbar-nav navbar-right">
			<li>
				  <% link_body = (content_tag(:i, '', class: 'fa fa-question') + ' Help').html_safe %>
				  <%= link_to link_body, help_path(lookup: "#{params[:controller]}.#{params[:action]}.help"), data: {toggle: 'modal', target: '#help_modal'} %>				  
			</li>
	        <li class="dropdown">
	          <a id="navbar_user_menu_toggle" href="#" class="dropdown-toggle" data-toggle="dropdown">
	          	<%= content_tag(:i, '<span class="caret"></span>'.html_safe, class: "fa fa-user navbar_user_icon") %>
	          </a>
	          <ul class="dropdown-menu" role="menu">
	    		<li>
				  <% link_body = (content_tag(:i, '', class: 'fa fa-cog') + ' ' + current_user.email).html_safe %>
				  <%= link_to link_body, user_path, class: 'trigger-response-modal' %>
		        </li>
	            <li class="divider"></li>
				<li>
					<%= link_to (content_tag(:i, "", class: "fa fa-sign-out") + " Sign out"),
						destroy_user_session_path,
						class: 'trigger-response-modal', :method => :delete %>
				</li>
	          </ul>
	        </li>
	      </ul>
	    </div>
	  </div>
	</nav>
	
<% else %>

<nav class="navbar user_signed_out navbar-default navbar-fixed-top" role="navigation">
	<div class="container-fluid">
		<%= link_to image_tag("engines_logo.png", class: "navbar-icon"), root_path, class: 'trigger-response-modal navbar-brand' %>

		<div class="pull-right">

			<%= render 'layouts/navbar_sign_in' %>

		</div>
	</div>
</nav>


<% end %>

<!-- Help modal -->
<div class="modal fade" id="help_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Loading help</h4>
      </div>
      <div class="modal-body">
		<p class="text-center"><%= content_tag(:i, nil, class: "fa fa-spinner fa-spin") %></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
