<%  service = @service
	flash_message ||= nil
	flash_alert_class ||= :danger
	service_state = service.state
	service_name = service.container_name
    if service_state.kind_of?(EnginesOSapiResult)
      service_state = "state_error"
    end
    indicator_class = "indicator_" + service.state_indicator
    background_class = "engine_" + service.state_indicator
    service_fqdn = service.fqdn
    # service_protocol = service.protocol
    if service_fqdn.kind_of?(EnginesOSapiResult)
      service_fqdn = "?"
    end    
%>

<% if flash_message.present? %>
	<%= content_tag(:div, nil, class: "flash_message_data", data: {messagebody: flash_message, alertclass: flash_alert_class}) %>
<% end %>

<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
  <div class="engine-gadget service btn-group">
    <button type="button" class="btn btn-default dropdown-toggle <%= background_class %>" data-toggle="dropdown">
      <div class="icon_holder">
      	<i class="fa fa-<%= service.fa_icon %>"></i>
      </div>
      <div class="text_holder">
          <%= content_tag(:i, "", class: "fa fa-circle indicator " + indicator_class) %> <small><%= service.state_indicator.humanize %></small>
    	  <strong><%= service_name %></strong><br>
	      <%= content_tag(:i, '', class: 'fa fa-bookmark-o') + ' ' + service.human_name %>
      </div>
    </button>
    <ul class="dropdown-menu engine-gadget-dropdown-menu" role="menu">
    	<li><div class="dropdown-title" %><%= service_name %></div></li>
  		<% if service_state == "running" %>
  			<li><div class="<%= indicator_class %> dropdown-title"><%= content_tag(:i, "", class: "fa fa-circle-o-notch fa-spin") %> Running</div></li>
  			<% if service_name != 'mgmt' %>
				<li><%= link_to content_tag(:i, "", class: "fa fa-stop") + " Stop", "javascript:void(0);", class: 'object_action', data: { action: "Stopping", url: stop_services_path(service_name: service_name) } %></li>
            	<li><%= link_to content_tag(:i, "", class: "fa fa-pause") + " Pause", "javascript:void(0);", class: 'object_action', data: { action: "Pausing", url: pause_services_path(service_name: service_name) } %></li>
        	<% end %>
  		<% elsif service_state == "paused" %>
  			<li><div class="<%= indicator_class %> dropdown-title"><%= content_tag(:i, "", class: "fa fa-circle-o-notch") %> Paused</div></li>
	 		<li><%= link_to content_tag(:i, "", class: "fa fa-pause") + " Unpause", "javascript:void(0);", class: 'object_action', data: { action: "Unpausing", url: unpause_services_path(service_name: service_name) } %></li>
  		<% elsif service_state == "stopped" %>
	  		<% if service.state_indicator == "error" %>
	  			<li><div class="<%= indicator_class %> dropdown-title"><%= content_tag(:i, "", class: "fa fa-warning") %> Error</div></li>
	  			<li><div class="dropdown-title"><small><%= service_state.humanize %></small></div></li>
			<% else %>
	  			<li><div class="<%= indicator_class %> dropdown-title"><%= content_tag(:i, "", class: "fa fa-circle-o-notch") %> Stopped</div></li>
			<% end %>
	  		<% if service.state_indicator == "error" %>
				<li><%= link_to content_tag(:i, "", class: "fa fa-stop") + " Stop", "javascript:void(0);", class: 'object_action', data: { action: "Stopping", url: stop_services_path(service_name: service_name) } %></li>
			<% end %>
	  	    <li><%= link_to content_tag(:i, "", class: "fa fa-play") + " Start", "javascript:void(0);", class: 'object_action', data: { action: "Starting", url: start_services_path(service_name: service_name) } %></li>
  		    <li class="divider"></li>
  		    <li><%= link_to content_tag(:i, "", class: "fa fa-repeat") + " Rebuild", "javascript:void(0);", class: 'object_action', data: { action: "Rebuilding", url: recreate_services_path(service_name: service_name) } %> </li>
  		<% elsif  service_state == "no_container" %>   
	  		<% if service.state_indicator == "error" %>
	  			<li><div class="<%= indicator_class %> dropdown-title"><%= content_tag(:i, "", class: "fa fa-warning") %> Error</div></li>
	  			<li><div class="dropdown-title"><small><%= service_state.humanize %></small></div></li>
			<% else %>
	        	<li><div class="<%= indicator_class %> dropdown-title"><%= content_tag(:i, "", class: "fa fa-circle-o") %> Disabled</div></li>
			<% end %>
  			<li><%= link_to content_tag(:i, "", class: "fa fa-check") + " Enable", "javascript:void(0);", class: 'object_action', data: { action: "Creating", url: create_container_services_path(service_name: service_name) } %></li> 
      <% else %>
         <li><div class="indicator_error dropdown-title"><%= content_tag(:i, "", class: "fa fa-circle-o") %> State error<br>(should be <%= service.state_indicator %>)</div></li>
      <%  end %>
		<li class="divider"></li>
      <% if @service.is_configurable? %>
		<% if service_state == "running" %>
			<li>
				<%= link_to content_tag(:i, "", class: "fa fa-gear") + " Configuration", service_configuration_path(service_name: service_name), class: 'trigger-response-modal' %>
			</li>
		<% else %>
			<li class="disabled">
				<%= link_to content_tag(:i, "", class: "fa fa-gear") + " Configuration", "javascript:void(0);" %>
			</li>
		<% end %>
	  <% else %>
			<li class="disabled">
				<%= link_to content_tag(:i, "", class: "fa fa-gear") + " Not configurable", "javascript:void(0);" %>
			</li>
	  <% end %>
  	  <li class="divider"></li>
	  <li>
		<%= link_to content_tag(:i, "", class: "fa fa-list-alt") + " Advanced", "javascript:void(0);", data: {toggle: "modal", target: ("#modal_" + service_name), url: service_report_path(service_name: service_name) }, role: "button", class: "modal_menu_item" %>
	  </li>
	  <li class="divider"></li>
 	  <li><%= link_to content_tag(:i, "", class: "fa fa-globe") + " " + service_fqdn, "http://" + service_fqdn, target: "_blank"%></li>
      </ul>
  </div>
</div>

<div class="modal application_detail advanced_detail" id="modal_<%= service_name %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title"><%= content_tag(:i, "", class: "fa fa-list-alt") %> Advanced details for <%= service_name %></h4>
      </div>
      <div class="modal-body" id="modal_<%= service_name %>_body">
        <div class="loading_spinner">
          <%= content_tag(:i, "", class: "fa fa-spinner fa-spin") %> 
        </div>
		<div class="modal_body_content"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

     

